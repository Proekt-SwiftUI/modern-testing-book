# Макросы, атрибуты и организация группы тестов

Вначале отвечу на вопрос из предыдущей главы: «Почему атрибут @Test — это макрос и в чем тут разница» ?
Если мы применяем макрос по отношению к методу — это атрибут. Без применения — это тип данных, в нашем случае макрос.

```swift
@Test // применяем атрибут к функции
func example() {...}
```

> Разница между атрибутом и макросом состоит в контексте.

В следующих главах, я расскажу более подробно про использование макросов.

## Немного о макросах и ключевых словах

<!--
Идея: расписать здесь информацию о том, что такое макрос, виды и ключевые слова.
Чтобы читатель понимал суть происходящего. Упомянуть, что с данной реализацией читатель столкнется далее.
-->

Если ты не знаком с макросами, то я дам краткую справку.

Макросы — это инструмент метапрограммирования<a href="#metaprog"><sup>[1]</sup></a>, который позволяет генерировать код на этапе компиляции. Они помогают уменьшить количество boilerplate-кода, упростить разработку и повысить читаемость программы. Макросы могут добавлять новые функции, свойства, методы или даже изменять существующие структуры данных. Более подробно в [документации языка][doc_macro].

Существует 2 основных вида:

1. **Freestanding macro** — в контексте программирования и в целом, freestanding можно перевести как **независимый** макрос.

Это означает, что такой макрос не зависит от конкретного типа данных (функции или структуры). Он существует сам по себе и может быть вызван в любом месте кода. В Swift такие макросы объявляют с помощью символа `#`:

```swift
func gatherInformation(about person: any Human, currentFn: String = #function) {
    if person.age < 18 {
        #warning("Человек не достиг совершеннолетнего возраста.")
    }

    print("Продолжаем выполнять метод: \(currentFn)")
    // ...
}
```

В данном случае, если условие верное, то ты получишь **предупреждение** и конкретное сообщение во время компиляции.

> Freestanding — это макрос, который используется независимо от других конструкций и вызывается напрямую в коде.

2. **Attached macro** — можно перевести как **прикрепленный** макрос.

**Attached** означает, что макрос прикреплен к определенному типу данных, например, к классу, структуре, свойству или функции. Он не существует самостоятельно (как независимый макрос), а расширяет или модифицирует конкретное выражение.

В Swift такие макросы обычно вызываются с помощью символа `@`:

```swift
@Observable
class ProfileData {
    let network = NetworkProvider()

	var user: UserProfile?
	var avatar: NSImage?
    // ...
}
```

Теперь, когда ты введен в курс дела, перейдем к детальном расмотрению основных макросов фреймворка Swift Testing.

<!-- Возможно, некоторые ключевые слова ты видишь впервые, поэтому я расскажу о каждом из них.

1. `@attached(member)` — 
2. `@attached(peer)` — 
3. `@_documentation(visibility: private)` — 
4. macro Suite(_ traits: any SuiteTrait...) — ключевое слово macro используется для объявления типа данных макрос, который принимает variadic параметр с `any SuiteTrait`
5. `#externalMacro(module: "TestingMacros", type: "SuiteDeclarationMacro")` — ещё один макрос -->

---

<a name="metaprog"><sup>[1]</sup>Метапрограммирование — вид программирования, связанный с созданием программ, которые порождают другие программы как результат своей работы (в частности, на стадии компиляции их исходного кода) либо программ, которые меняют себя во время выполнения (самомодифицирующийся код).

[doc_macro]:  https://docs.swift.org/swift-book/documentation/the-swift-programming-language/macros/

<!-- https://github.com/swiftlang/swift/blob/ea9920490a464d0aa14461591fac3b1dd023f91a/stdlib/public/core/Macros.swift -->