<!DOCTYPE HTML>
<html lang="ru" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>@Test - Современное тестирование Swift Testing</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../welcome.html"><strong aria-hidden="true">1.</strong> Введение</a></li><li class="chapter-item expanded "><a href="../basic_macro.html"><strong aria-hidden="true">2.</strong> Макросы сравнения</a></li><li class="chapter-item expanded "><a href="../Macros/intro.html"><strong aria-hidden="true">3.</strong> Макросы @Test, @Suite и @Tag</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Macros/macro_test.html" class="active"><strong aria-hidden="true">3.1.</strong> @Test</a></li><li class="chapter-item expanded "><a href="../Macros/macro_suite.html"><strong aria-hidden="true">3.2.</strong> @Suite</a></li><li class="chapter-item expanded "><a href="../Macros/macro_tag.html"><strong aria-hidden="true">3.3.</strong> @Tag</a></li></ol></li><li class="chapter-item expanded "><a href="../protocol_Trait.html"><strong aria-hidden="true">4.</strong> Кортежи</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">4.1.</strong> Comment</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.</strong> ConditionTrait</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.3.</strong> HiddenTrait</div></li><li class="chapter-item expanded "><a href="../Traits/TimeLimitTrait.html"><strong aria-hidden="true">4.4.</strong> TimeLimitTrait</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.5.</strong> Bug</div></li><li class="chapter-item expanded "><a href="../Traits/IssueTrait.html"><strong aria-hidden="true">4.6.</strong> Issue</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.7.</strong> ParallelizationTrait</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.8.</strong> Tag</div></li></ol></li><li class="chapter-item expanded "><a href="../tags.html"><strong aria-hidden="true">5.</strong> Теги везде</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> Добавляем собственный кортеж</div></li><li class="chapter-item expanded "><a href="../best_practice_short.html"><strong aria-hidden="true">7.</strong> Best practice</a></li><li class="chapter-item expanded "><a href="../runner.html"><strong aria-hidden="true">8.</strong> Кто управляет тестами</a></li><li class="chapter-item expanded "><a href="../compare_xctest_and_modern_aproach.html"><strong aria-hidden="true">9.</strong> Сравнение с XCTest</a></li><li class="chapter-item expanded "><a href="../xcode_meta.html"><strong aria-hidden="true">10.</strong> Мета информация и обозначения</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Современное тестирование Swift Testing</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <style>
.mdbook-alerts {
  padding: 8px 16px;
  margin-bottom: 16px;
  border-left: 0.25em solid var(--mdbook-alerts-color);
}

.mdbook-alerts > *:first-child {
  margin-top: 0;
}

.mdbook-alerts > *:last-child {
  margin-bottom: 0;
}

.mdbook-alerts-title {
  display: flex;
  font-weight: 600;
  align-items: center;
  line-height: 1;
  color: var(--mdbook-alerts-color);
  text-transform: capitalize;
}

.mdbook-alerts-icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  margin-right: 0.2em;
  background-color: currentColor;
  -webkit-mask: no-repeat center / 100%;
  mask: no-repeat center / 100%;
  -webkit-mask-image: var(--mdbook-alerts-icon);
  mask-image: var(--mdbook-alerts-icon);
}

.mdbook-alerts-note {
  --mdbook-alerts-color: rgb(9, 105, 218);
  /* https://icon-sets.iconify.design/material-symbols/info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16v-4q0-.425-.288-.712T12 11q-.425 0-.712.288T11 12v4q0 .425.288.713T12 17m0-8q.425 0 .713-.288T13 8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8q0 .425.288.713T12 9m0 13q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20m0-8"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-tip {
  --mdbook-alerts-color: rgb(26, 127, 55);
  /* https://icon-sets.iconify.design/material-symbols/lightbulb-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 22q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-3-3q-.425 0-.712-.288T8 18q0-.425.288-.712T9 17h6q.425 0 .713.288T16 18q0 .425-.288.713T15 19zm-.75-3q-1.725-1.025-2.738-2.75T4.5 9.5q0-3.125 2.188-5.312T12 2q3.125 0 5.313 2.188T19.5 9.5q0 2.025-1.012 3.75T15.75 16zm.6-2h6.3q1.125-.8 1.738-1.975T17.5 9.5q0-2.3-1.6-3.9T12 4Q9.7 4 8.1 5.6T6.5 9.5q0 1.35.613 2.525T8.85 14M12 14"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-important {
  --mdbook-alerts-color: rgb(130, 80, 223);
  /* https://icon-sets.iconify.design/material-symbols/chat-info-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 7q.425 0 .713-.288T13 6q0-.425-.288-.712T12 5q-.425 0-.712.288T11 6q0 .425.288.713T12 7m0 8q.425 0 .713-.288T13 14v-4q0-.425-.288-.712T12 9q-.425 0-.712.288T11 10v4q0 .425.288.713T12 15m-6 3l-2.3 2.3q-.475.475-1.088.213T2 19.575V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18zm-.85-2H20V4H4v13.125zM4 16V4z"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-warning {
  --mdbook-alerts-color: rgb(154, 103, 0);
  /* https://icon-sets.iconify.design/material-symbols/warning-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M2.725 21q-.275 0-.5-.137t-.35-.363q-.125-.225-.137-.488t.137-.512l9.25-16q.15-.25.388-.375T12 3q.25 0 .488.125t.387.375l9.25 16q.15.25.138.513t-.138.487q-.125.225-.35.363t-.5.137zm1.725-2h15.1L12 6zM12 18q.425 0 .713-.288T13 17q0-.425-.288-.712T12 16q-.425 0-.712.288T11 17q0 .425.288.713T12 18m0-3q.425 0 .713-.288T13 14v-3q0-.425-.288-.712T12 10q-.425 0-.712.288T11 11v3q0 .425.288.713T12 15m0-2.5"%2F%3E%3C%2Fsvg%3E');
}

.mdbook-alerts-caution {
  --mdbook-alerts-color: rgb(207, 34, 46);
  /* https://icon-sets.iconify.design/material-symbols/brightness-alert-outline-rounded/ */
  --mdbook-alerts-icon: url('data:image/svg+xml,%3Csvg xmlns="http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg" width="24" height="24" viewBox="0 0 24 24"%3E%3Cpath fill="currentColor" d="M12 17q.425 0 .713-.288T13 16q0-.425-.288-.712T12 15q-.425 0-.712.288T11 16q0 .425.288.713T12 17m0-4q.425 0 .713-.288T13 12V8q0-.425-.288-.712T12 7q-.425 0-.712.288T11 8v4q0 .425.288.713T12 13m-3.35 7H6q-.825 0-1.412-.587T4 18v-2.65L2.075 13.4q-.275-.3-.425-.662T1.5 12q0-.375.15-.737t.425-.663L4 8.65V6q0-.825.588-1.412T6 4h2.65l1.95-1.925q.3-.275.663-.425T12 1.5q.375 0 .738.15t.662.425L15.35 4H18q.825 0 1.413.588T20 6v2.65l1.925 1.95q.275.3.425.663t.15.737q0 .375-.15.738t-.425.662L20 15.35V18q0 .825-.587 1.413T18 20h-2.65l-1.95 1.925q-.3.275-.662.425T12 22.5q-.375 0-.737-.15t-.663-.425zm.85-2l2.5 2.5l2.5-2.5H18v-3.5l2.5-2.5L18 9.5V6h-3.5L12 3.5L9.5 6H6v3.5L3.5 12L6 14.5V18zm2.5-6"%2F%3E%3C%2Fsvg%3E');
}

</style>
<h1 id="test"><a class="header" href="#test">@Test(…)</a></h1>
<p>Глава про макрос @Test разделена на 4 сценария:</p>
<ul>
<li><a href="#%D0%A3%D1%81%D0%BB%D0%BE%D0%B2%D0%B8%D0%B5-%D0%B8%D0%BB%D0%B8-runtime-condition">Условие</a></li>
<li><a href="#%D0%9E%D0%B1%D1%89%D0%B8%D0%B5-%D1%85%D0%B0%D1%80%D0%B0%D0%BA%D1%82%D0%B5%D1%80%D0%B8%D1%81%D1%82%D0%B8%D0%BA%D0%B8-%D0%B8%D0%BB%D0%B8-%D1%82%D1%8D%D0%B3%D0%B8">Общие характеристики или тэги</a></li>
<li><a href="#%D0%90%D1%80%D0%B3%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D1%8B">Запуск с различными аргументами</a></li>
<li><a href="#%D0%A2%D0%BE%D0%BD%D0%BA%D0%BE%D1%81%D1%82%D0%B8">Тонкости успользования</a></li>
</ul>
<p>Здесь ты столкнешься с распространенными проблемами в тестировании и узнаешь как их решить.
Помимо этого, я расскажу о тонкостях работы макроса.</p>
<h3 id="Условие-или-runtime-condition"><a class="header" href="#Условие-или-runtime-condition">Условие или runtime condition</a></h3>
<p>Во-первых, тесты с условием.
Некоторые тесты должны выполняться только при определённых обстоятельствах — например, на конкретных устройствах или в определённом окружении (environments).</p>
<p>Для этого, ты можешь применить кортеж условия (<code>ConditionTrait</code>) <code>.enabled(if: ...)</code>:</p>
<pre><code class="language-swift">@Test(.enabled(if: Backport.isRemoteVersion))
func backportVersion() async {
	// ...
}
</code></pre>
<p>Ты передаешь <em>некоторое</em> условие, которое будет оцениваться перед запуском теста и если условие ложно, тест помечается как пропущенный и не выполняется.</p>
<blockquote>
<p>→ Test 'backportVersion()' skipped</p>
</blockquote>
<p>В других случаях необходимо полностью отключить выполнение теста (чтобы тест никогда не выполнялся). Для этого используй кортеж <code>.disabled(...)</code>:</p>
<pre><code class="language-swift">@Test(.disabled("Известный баг, отключаем до фикса #PR-3781"))
func fetchFeatureFlag() async {
  // ...
}
</code></pre>
<blockquote>
<p>→ Test 'fetchFeatureFlag()' skipped: Известный баг, отключаем до фикса #PR-3781</p>
</blockquote>
<p>Использование кортежа <code>.disabled(...)</code> является предпочтительнее комментирования тела функции, поскольку в закомментированном состоянии — тело функции компилируется:</p>
<!-- TODO: Добавить этот кейс в лучшие практики!!! -->
<pre><code class="language-swift">// Избегайте такого способа отключения теста
@Test("Закомментирую на время фикса #PR-3781")
func fetchAnotherFlag() {
// try await Task(priority: .background) {
//	...
// }
}
</code></pre>
<p>Тебе может показаться, что одного комментария недостаточно и по-хорошему нужно указать <strong>причину</strong> отключения: баг, ожидание PR (пулл реквеста) или иное условие. Что ж, в дополнение к комментарию ты можешь использовать кортеж <code>.bug(...)</code>, чтобы явно указать на проблему:</p>
<pre><code class="language-swift">@Test(
	"Проверка валидности поля именя",
	.disabled("Бекендер исправляет модель"),
	.bug("https://github.com/issue/7329", "Сломанная валидация имени и модель #7329")
)
func validateNameProperty() async throws {
	// ...
}
</code></pre>
<p>Данный баг будет отображаться в отчете и вы сможете перейти по ссылке, которая ассоциируется с ним:</p>
<p><img src="../assets/validateNameProperty_link.png" alt="Отчет в Xcode 16" /></p>
<p>Когда необходимо запустить тест только на конкретной версии ОС (операционной системы), можешь использовать <a href="https://docs.swift.org/swift-book/documentation/the-swift-programming-language/controlflow#Checking-API-Availability">атрибут @available(...)</a>, чтобы указать на какой версии доступен тест.
Атрибут <code>@available(...)</code> позволяет понимать, что у теста есть условие, связанное с версией операционной системы и точнее отражать это в результатах.</p>
<pre><code class="language-swift">@Test
@available(macOS 15, *)
func usesNewAPIs() {
  // ...
}
</code></pre>
<p>Избегайте использования проверки доступности с помощью макросов <code>#available</code> и <code>#unavailable</code>:</p>
<pre><code class="language-swift">// ❌ Избегайте использования проверки доступности в рантайме с помощью #available и #unavailable
@Test
func hasRuntimeVersionCheck() {
  guard #available(macOS 15, *) else { return }
  // ...
}

// ✅ Используйте атрибут @available для функции или метода
@Test
@available(macOS 15, *)
func usesNewAPIs() {
  // ...
}
</code></pre>
<p><img src="../assets/available.png" alt="Available attribute" /></p>
<blockquote>
<p>@available(...) используется для обозначения доступности типа данных или функции, а #available используется когда необходимо выполнить часть кода только в определенной версии ОС.</p>
</blockquote>
<h3 id="Общие-характеристики-или-тэги"><a class="header" href="#Общие-характеристики-или-тэги">Общие характеристики или тэги</a></h3>
<p>Давай обсудим, как ты можешь объединять тесты, которые имеют общие свойства, даже если они находятся в разных типах данных или файлах. Swift Testing поддерживает создание пользовательских тэгов для тестов.</p>
<!-- Дать определение что такое теги и в контексте тестирования -->
<p>Я уже начал использовать теги в этом проекте. В Test Navigator все теги отображаются внизу.
Чтобы увидеть тесты, к которым применены теги, мы можем переключиться в новый режим: группировка по тэгам.</p>
<!-- TODO: скрин: группировка по тегам -->
<p>Давайте применим тег к одному из тестов, которые мы писали ранее. Для этого мы добавим кортеж <code>.tags(...)</code> в атрибут @Test. Этот тест проверяет логику форматирования данных. В этом проекте уже есть другой тест, связанный с форматированием, поэтому давайте добавим тег formatting и к этому тесту.</p>
<p>После этого он отобразится в Test Navigator под соответствующим тегом. Я написал еще один тест, который также проверяет форматирование данных, и добавлю его сюда. Поскольку оба теста связаны с форматированием информации о видео, давайте сгруппируем их в поднабор.</p>
<p>Теперь мы можем переместить тег formatting на уровень @Suite, чтобы он наследовался всеми содержащимися тестами. После этого можно удалить теги из каждого отдельного метода с атрибутом @Test, так как они теперь наследуются.</p>
<p>Вы можете ассоциировать теги с тестами, которые имеют общие черты. Например, вы можете применить общий тег ко всем тестам, которые проверяют определенную функцию или подсистему. Это позволяет запускать все тесты с конкретным тегом, фильтровать их в Test Report и даже видеть аналитические данные, например, когда несколько тестов с одним и тем же тегом начинают падать.</p>
<p>Теги могут применяться к тестам в разных файлах, наборах или таргетах и даже делиться между несколькими проектами. При использовании Swift Testing предпочтительнее использовать теги вместо имен тестов для их включения или исключения из тестового плана. Чтобы добиться наилучших результатов, всегда выбирайте наиболее подходящий тип свойства для каждой ситуации. Не все сценарии должны использовать теги. Например, если вы хотите выразить условие выполнения во время выполнения, используйте .enabled(if ...), как мы обсуждали ранее.</p>
<!-- Next, let’s talk about how you can associate tests which have characteristics in common, even if they’re in different suites or files. Swift Testing supports assigning custom tags to tests. I've already begun using tags in this project. The Test Navigator shows all the tags at the bottom. To view the tests which each of these tags have been applied to, we can switch to the new Group By: Tag mode.
Let’s apply a tag to one of the tests we wrote earlier. To do this, we’ll add a tags trait to the test via the @Test attribute. This test is validating some data formatting logic. There’s already another test in this project which relates to formatting, so let’s add the formatting tag to this test too.
Once we do that, it shows in the Test Navigator under that tag.
I wrote another test which also validates data formatting, which I’ll add here.
Since these two tests are about the formatting of Video information, let’s group them into a sub-suite.

Now, we can move the formatting tag up to the @Suite, so it will be inherited by all the tests it contains. Finally, we can delete the tags from each individual @Test function, since they’re now inherited.

You can associate tags with tests which have things in common. As an example, you might apply a common tag to all the tests which validate a particular feature or subsystem. This lets you run all the tests with a particular tag. It also lets you filter them in the Test Report, and even see insights there such as when multiple tests with the same tag begin failing. Tags themselves can be applied to tests in different files, suites, or targets. They can even be shared among multiple projects.
When using Swift Testing, prefer tags over specific names of tests when including or excluding them from a test plan. For best results, always use the most appropriate type of trait for each circumstance. Not every scenario should use tags. For example, if you’re trying to express a runtime condition, use .enabled(if ...) as we discussed earlier. -->
<p>В главе про @Test я не буду рассказывать о том как создать собсвенный тэг и в целом об этом кортеже, только совместное использование.
Узнать о макросе @Tag можно здесь.</p>
<h3 id="Аргументы"><a class="header" href="#Аргументы">Аргументы</a></h3>
<p>The last workflow I’d like to show is my favorite. Repeating tests with different arguments each time. Here's an example of why that can be useful. In this project there are several tests which check the number of continents that various videos mention. Each of them follows a similar pattern: it creates a fresh videoLibrary, looks up a video by name, and then uses the #expect macro to check how many continents it mentions.</p>
<h3 id="Тонкости"><a class="header" href="#Тонкости">Тонкости</a></h3>
<pre><code class="language-swift">@Test("Как определить, функция для теста изолирована на глобальном акторе ?")
@MainActor
func determineGlobalActor() async {
	await MainActor.run {}
}
</code></pre>
<p>// How do we call a function if we don't know whether it's <code>async</code> or
// <code>throws</code>? Yes, we know if the keywords are on the function, but it could
// be actor-isolated or otherwise declared in a way that requires the use of
// <code>await</code> without us knowing. Abstract away the need to know by invoking
// the function along with an expression that always needs <code>try</code> and one
// that always needs <code>await</code>, then discard the results of those expressions.
//
// We may also need to call init() (although only for instance methods.)
// Since we can't see the actual init() declaration (and it may be
// synthesized), we can't know if it's noasync, so we assume it's not.
//
// If the function is noasync, we will need to call it from a synchronous
// context. Although <code>async</code> is out of the picture, we still don't know if
// <code>try</code> is needed, so we do the same tuple dance within the closure.
// Calling the closure requires <code>try</code>, hence why we have two <code>try</code> keywords.
//
// If the function is noasync <em>and</em> main-actor-isolated, we'll call through
// MainActor.run to invoke it. We do not have a general mechanism for
// detecting isolation to other global actors.</p>
<pre><code class="language-swift">lazy var isMainActorIsolated = !functionDecl.attributes(named: "MainActor", inModuleNamed: "_Concurrency").isEmpty
var forwardCall: (ExprSyntax) -&gt; ExprSyntax = {
  "try await Testing.__requiringTry(Testing.__requiringAwait(\($0)))"
}

let forwardInit = forwardCall

if functionDecl.noasyncAttribute != nil {
  if isMainActorIsolated {
    forwardCall = {
      "try await MainActor.run { try Testing.__requiringTry(\($0)) }"
    }
  } else {
    forwardCall = {
      "try { try Testing.__requiringTry(\($0)) }()"
    }
  }
}
</code></pre>
<h4 id="Нет-необходимости-возвращать-тип-данных"><a class="header" href="#Нет-необходимости-возвращать-тип-данных">Нет необходимости возвращать тип данных</a></h4>
<p>Если ты внимательно читал код, то обратил внимание что ни одна функция не возвращает конкретный тип данных.
Указание возвращаемого типа данных не является ошибкой, проверка с помощью макросов выполняется, но в этом случае ты получишь предупреждение:</p>
<pre><code class="language-swift">@Test
func checkReturnType() -&gt; any Collection {
  let collection = Array(1...10)
  #expect(collection.contains(10))

  return collection
}
</code></pre>
<blockquote>
<p>⚠️ The result of this function will be discarded during testing</p>
</blockquote>
<p>Возможно в будущем, инженеры Apple добавят такую возможность, но на данный момент они не нашли подходящего сценария, когда необходимо возвращать тип данных.
Такая проверка возможна с помощью сравнения сигнатуры возвращаемого типа:</p>
<pre><code class="language-swift">if let returnType = function.signature.returnClause?.type, !returnType.isVoid {
    diagnostics.append(.returnTypeNotSupported(returnType, on: function, whenUsing: testAttribute))
}
</code></pre>
<h4 id="Неподдерживаемые-ключевые-слова"><a class="header" href="#Неподдерживаемые-ключевые-слова">Неподдерживаемые ключевые слова</a></h4>
<p>На момент выхода книги, в структуре данных <a href="https://github.com/swiftlang/swift-testing/blob/main/Sources/TestingMacros/TestDeclarationMacro.swift#L84">TestDeclarationMacro</a>, которая реализует макрос <code>@Test</code>, существуют неподдерживаемые ключевые слова:</p>
<pre><code class="language-swift">struct TestDeclarationMacro: PeerMacro, Sendable {
    // ...
    // We don't support inout, isolated, or _const parameters on test functions.
    for parameter in parameterList {
        let invalidSpecifierKeywords: [TokenKind] = [.keyword(.inout), .keyword(.isolated), .keyword(._const),]
        // ...
    }
}
</code></pre>
<p>Это легко проверить, создав тест с одним из этих ключевых слов:</p>
<pre><code class="language-swift">@Test("Проверка не поддерживаемых слов")
func parameterCanBeSupported(value: isolated (any Actor)? = #isolation) {}
</code></pre>
<blockquote>
<p>❌ Attribute <code>Test</code> cannot be applied to a function with a parameter marked <code>isolated</code></p>
</blockquote>
<h4 id="test-только-для-func"><a class="header" href="#test-только-для-func">Test только для func</a></h4>
<p>Или иными словам, ты можешь применить атрибут только для функций или методов.</p>
<pre><code class="language-swift">// The @Test attribute is only supported on function declarations.
guard let function = declaration.as(FunctionDeclSyntax.self) else {
    diagnostics.append(.attributeNotSupported(testAttribute, on: declaration))
    return false
}
</code></pre>
<h4 id="1-атрибут-для-1-функции"><a class="header" href="#1-атрибут-для-1-функции">1 атрибут для 1 функции</a></h4>
<pre><code class="language-swift">// Only one @Test attribute is supported.
let suiteAttributes = function.attributes(named: "Test")
if suiteAttributes.count &gt; 1 {
    diagnostics.append(.multipleAttributesNotSupported(suiteAttributes, on: declaration))
}
</code></pre>
<h4 id="Не-приминим-для-generics"><a class="header" href="#Не-приминим-для-generics">Не приминим для Generics</a></h4>
<p>/// Create a diagnostic message stating that the <code>@Test</code> or <code>@Suite</code> attribute
/// cannot be applied to a generic declaration.</p>
<pre><code class="language-swift">static func genericDeclarationNotSupported(_ decl: some SyntaxProtocol, whenUsing attribute: AttributeSyntax, becauseOf genericClause: some SyntaxProtocol, on genericDecl: some SyntaxProtocol) -&gt; Self {
if Syntax(decl) != Syntax(genericDecl), genericDecl.isProtocol((any DeclGroupSyntax).self) {
    return .containingNodeUnsupported(genericDecl, genericBecauseOf: Syntax(genericClause), whenUsing: attribute, on: decl)
} else {
    // Avoid using a syntax node from a lexical context (it won't have source
    // location information.)
    let syntax = (genericClause.root != decl.root) ? Syntax(decl) : Syntax(genericClause)
    return Self(
    syntax: syntax,
    message: "Attribute \(_macroName(attribute)) cannot be applied to a generic \(_kindString(for: decl))",
    severity: .error
    )
}
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../Macros/intro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../Macros/macro_suite.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../Macros/intro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../Macros/macro_suite.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
